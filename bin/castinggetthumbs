#!/bin/sh

export PATH=$PATH:$(dirname $0)
. $(which casting-helpers) || exit 1

uname | grep -q Darwin
if [ $? -eq 0 ]
then
    alias edit=open
else
    alias edit=gedit
    alias open=gnome-open
fi

pwd | egrep -q "^$base.*casting[0-9]*$" || end 1 "Ce n'est pas un dossier de casting"

castingdir=$client/$job/$casting
echo "client: $client"
echo "job: $job"
echo "casting: $casting"
echo "remote: $remote"

rsync -Wavz $remote/$castingdir/.sources/.browsercache/ $base/$castingdir/browsercache/ --exclude "*thumb*" \
    || end $? "Erreur Ã  la synchronisation" \
    && if [ ! -f liste -o ! -f ignore ]
then
    [ ! -f liste ] && touch liste
    [ ! -f ignore ] && touch ignore
    [ ! -f thumbs ] && touch thumbs
    edit liste ignore thumbs >/dev/null 2>/dev/null &
    open $(ls -d browsercache/* | sort -n | head -1) >/dev/null 2>/dev/null &
fi

rsync -Wavz $remote/$castingdir/.sources/times $base/$castingdir/

end $?
