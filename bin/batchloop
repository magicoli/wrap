#!/bin/bash

PGM=$(basename $0)
TMP=/tmp/$PGM.$$

SDDIR=../mp4
HDDIR=../mp4-hd
WEBDIR=../web

[ -f $(dirname "$0")/casting-helpers ] && . $(dirname "$0")/casting-helpers || exit 1

if [ "$1" == "--large" ]
	then
	dest=$HDDIR
	method=$2
else
	dest=$SDDIR
	method=$1
fi

[ ! -d "$dest" ] && echo "$dest missing" && exit 1
[ ! -d "$WEBDIR" ] && echo "$WEBDIR missing" && exit 2
mkdir -p "$WEBDIR/.browsercache"

while true
do
	# scratchmove --mp4 ./ $dest/
	batchff liste
	batchthumbs liste $method > $TMP.playlist
	mv $TMP.playlist $WEBDIR/playlist.php

	# batchturbo liste
	# batchthumbs liste > playlist.php
	# batchsync -nt -nv
	echo
	read -t 10
done
